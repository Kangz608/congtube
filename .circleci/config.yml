version: 2
jobs:
  build:
    docker:
      - image: circleci/python:3.6.1
    working_directory: ~/congtube

    steps:
      - checkout
      - setup_remote_docker:
          version: 18.06.0-ce
      - run:
          name: folder
          command: |
            ls -al
            pwd
      - run:
          name: Install awscli
          command: sudo pip install awscli
      - run:
          name: Deploy
          command: |
            aws configure set profile.prod.aws_access_key_id AKIA2GB5QVA4PHBPUDHX
            aws configure set profile.prod.aws_secret_access_key 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
            aws configure set profile.prod.region ap-northeast-2
            docker login -u AWS -p eyJwYXlsb2FkIjoiWHFydG83Q0NkNmswOGo5azBzRFQzMkFsb3Fwc1dJOG5pY3V3Yk80Z1Z1T3I3S1ovZVZEeVRwWkhrRXlmSDVzeGROL3VsWGlla00rTzZhRW0ySXpHaGVwdGFVSnZKV0ZCS1N4eTB4UGE2c0RuOXFuWExDK0NCNXFGeHhqcmt1eGxxWDE2MVoxMGNqTEtkUkhDQ1ZxMGpJa3VPbG5EVk9Oek1MdWhsejJ1NkZQQTRBaHpZU2R2Y1VjVVJGcmJnOFd6T3NFWmlMYVVzSllBZ3FzOG44ZEszcXA2L201bnp2SUc0R2VvNXAyRnNTVVE1WHd0cldQbGZwcWhZbzNXTlJTNHVDUzNFZHNUdDhLeHEzRHllYzlYWEphdjdUZUN5UDlydS9GQkZtdUNSOXI4Rk02OW9xcUd1TGw4cUF3RU9udE1pTU9xN2lDdFVqZU5ZK2RaTW5YMERnL3h3ZzdZU1ppZ2R0TERPVWJ4TmdOK2ZUN1BmMHoyQXpaQnk0TUZpdjBmU2xCK2lLSFQyZngzZWVqeHNqZjRSdHlWTWVFT1NxN3drZ2N4cUtWeVZwS0hXeVgxaGVjOUtlQ3Nyd1U2bU5hYk5TZEFLNzRHVzVkejZzS1NhY2tyZ3pHcHBFd0w3SForMTV0RS9Fa1JrRmFha3laV1VRYndJZ1YrZGRrM2ZRK3dJL0pESE5TTmhRaWIxNkZZaVRhcUR2M1QwdDViZTF0OVFKcEtzK0NJRHRYbm1QdEtkT2plVkE5Z29haWxXRTJRSmZ0ZEVyVTA2TkFpUXIrVW1vMUNNZlBqTlM0K2NlWmw3b0xNU3JEdGJCcHBGZXRibVY1VU5zbjZOY0YvOG50eVQwTEhSZUdzKzJIV3FQbVVlZmlTdEdxQXhIMzVKVVgrdEd2WGVjTW1UdkphR1o0RTJIV1VwWXBYaGhLVDlVc1hxbEdUTWg4YUI3N3lrcGFhdkVsY094Wk1KOHptTjV1WUM1WXhmbXN3Vmw1UnZJU2V1THZ3SmxKcDlhYnRTVm1vbWMrcGduQVBRUFZFV2lpUWxGTjYvQ0RFNGlHYTRJTHVKL1FEeU51NTJ2NmxNVnVvTW13RlNHRVdCdVc1V1QyNkxOUmcveHhyczlRUFozdWI2cXcvcS9PN01XVzlBZWQ1eWpoMytEM1FDNnRwMU1zV1Y4VzdhZTJOd0JuR0Q2WG5LYms4VEdRSHhWbmE5T0JBbURYdW1rc0pZSytkRGJNNnhlNFBtaFdFcUdqRjBJRkY5WVpyZFJLN1pmL1I2WEhqY3c5S0dpSHBiYlZFUHVKRXA1RVJ4c0V2R1IxQTJ0Q0FFK1M3ZlhnU2RSZURBc0o0dkRDRE1jQWkxaU80dTRpSFRkOHN4Y3l1VzRrOTdNa0kzd3hWSC9NQXFsV3c0dC9mclRrSnR4Y0FuREhvaVdURUIwTWVFNHBtSHlWM0RuemlRMllpIiwiZGF0YWtleSI6IkFRSUJBSGhBT3NhVzJnWk4wOVdOdE5Ha1ljOHFwMTF4U2haL2RyRUVveTFIazhMWFdnSEdrOUZKMjJFa25xaE54M1h2VHJUL0FBQUFmakI4QmdrcWhraUc5dzBCQndhZ2J6QnRBZ0VBTUdnR0NTcUdTSWIzRFFFSEFUQWVCZ2xnaGtnQlpRTUVBUzR3RVFRTXR1SmhUMUNhWnFYSjh2aVlBZ0VRZ0RzNlpma2ZFSUNDRHhwaitROUpYcVRORXNaQzYrUU1VZWNqaGhNRE0rcC9BSjBnOWlpaXorNEkxZ0svMUZrWExibFVLTHl5andHTENIOWVLZz09IiwidmVyc2lvbiI6IjIiLCJ0eXBlIjoiREFUQV9LRVkiLCJleHBpcmF0aW9uIjoxNTc1NDY0MzM1fQ== https://700208687160.dkr.ecr.ap-northeast-2.amazonaws.com
#            (aws ecr get-login --no-include-email --region ap-northeast-2)
            docker build -t congtube .
            docker tag congtube:latest 700208687160.dkr.ecr.ap-northeast-2.amazonaws.com/congtube:latest
            docker push 700208687160.dkr.ecr.ap-northeast-2.amazonaws.com/congtube:latest
